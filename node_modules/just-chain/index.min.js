(function(a,b){if(a.window&&typeof define==="function"&&define.amd){define(function(d){var e=d("./lib/promise.js");return b(e);});}else{if(module&&module.exports){var c=require("./lib/promise.js");
module.exports=b(c);}}})(this,function(i){var g=i;var e=e||function(j){setTimeout(function(){j();},0);};g.chain=function a(o,l,p){var j=0,n=o,m=l.length;
function k(){while(l.length){(function(q){n=n.then(function(r){j++;return g(function(t,u){q(r,t,u);});});})(l.shift());}}k();return n.then(function(q){k=null;
return p(null,q,j,m);},function(q){k=null;return p(q,null,j,m)||q;});};g.makePromiseArray=function f(j,m,k){var o=-1,p=j.length,l=[],n=[];while((++o)<p){(function(r,q){var s=Array.isArray(r)?r:[r];
r=null;l.push(function(v,t,u){m.apply(k||null,s.concat(function(x,w){if(x||x===false){u(x);}else{n.push(w||true);t(q===p-1?n:true);}}));});})(j[o],o);}return l;
};g.makeChaining=function b(k,j){return function l(o,m,n){return k(o,function(p){return m(j(p));},n);};};g.memory=function d(j){return function(m,l,k){return g(function(o,p){var n=function n(r,q){if(r||r===false){p(r);
}else{o(q);}e(function(){n=null;m=null;});};if(Array.isArray(m)){j.apply(null,m.concat(n));}else{j(m,n);}}).then(l,k);};};g.foreverRun=function c(m,k,j){(function l(){if(k()===false){j();
}else{setTimeout(l,m);}})();};g.forever=function h(k,l,j,m){if(!m){l=l.bind(k||null);}g(l).then(function(){h(k,l,j,true);},j);};return g;});